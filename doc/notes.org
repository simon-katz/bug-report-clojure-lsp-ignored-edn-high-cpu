* Notes
** Overview
*** I'm using `clojure-lsp` with Emacs
*** I think `clojure-lsp` is doing unnecessary work when `:paths-ignore-regex` is used
**** As expected linting messages are not displayed in the UI, but I believe the analysis work still happens
**** For large files, this can cause Emacs to become unresponsive
** TODO Note versions of things
** This repo demonstrates the problem
*** This repo has some edn files
**** These:
***** `edn-files/small-5-4.edn`
***** `edn-files/medium-1500-4.edn`
**** Those files are generated by code in the `create-edn-files` namespace
**** You can modify that namespace to generate different (maybe larger) edn files
*** With the repo as it is:
**** I get expected behaviour:
***** If I edit one of the edn files so that a map has a missing value:
****** After a short delay, I get a lsp-ui message reporting the syntax error:
missing value for key :z [missing-map-value]
*** If I ignore edn files
**** Add `{:paths-ignore-regex [".*edn"]}` to `.lsp/config.edn`
**** In Emacs, `M-x lsp-workspace-restart`
**** The behaviour is the same as before, except:
***** (EXPECTED) Emacs doesn't report the map with the missing value
***** (UNEXPECTED) All the other things still happen
****** It seems that the analysis work still happens
****** If I move the cursor around in an edn buffer, or edit the buffer:
******* In my `clojure-lsp.log` file, I get log entries like this:
2023-05-28T10:56:00.899Z  INFO [clojure-lsp.handlers:441] - :code-actions 318ms
******* `clojure-lsp` uses some CPU
******** More CPU for the bigger file
*** Larger edn files
**** Create a larger edn file
***** In the `create-edn-files` namespace:
****** `(create-edn-file "big" 2000 4)`
**** When `clojure-lsp` analyses the file
***** (UNEXPECTED) Error in *Messages* buffer
LSP :: Error from the Language Server: Internal error (Internal Error)
***** (UNEXPECTED) In my `clojure-lsp.log` file, I get:
****** Stack overflow errors
2023-05-28T18:00:37.592Z  ERROR [clojure-lsp.server:55] - Error receiving message: Internal error (-32603)
{:id 888, :method "textDocument/documentSymbol"}

                            ...                                  
         clojure.core/concat/fn                     core.clj: 727
               clojure.core/seq                     core.clj: 139
                            ...                                  
         clojure.core/concat/fn                     core.clj: 727
               clojure.core/seq                     core.clj: 139
                            ...

         (the above repeated many times)

com.oracle.svm.core.graal.snippets.StackOverflowCheckImpl.throwNewStackOverflowError  StackOverflowCheckImpl.java: 309
     com.oracle.svm.core.graal.snippets.StackOverflowCheckImpl.newStackOverflowError  StackOverflowCheckImpl.java: 329
    com.oracle.svm.core.graal.snippets.StackOverflowCheckImpl.newStackOverflowError0  StackOverflowCheckImpl.java: 333
java.lang.StackOverflowError:
*** Very large files
**** Create a very large edn file
***** In the `create-edn-files` namespace:
****** `(create-edn-file "very-big" 10000 26)`
**** When `clojure-lsp` analyses the file
***** As above, and also...
***** (UNEXPECTED) `clojure-lsp` uses lots of CPU
**** If I edit the file
***** (UNEXPECTED) Emacs uses lots of CPU and becomes unresponsive
